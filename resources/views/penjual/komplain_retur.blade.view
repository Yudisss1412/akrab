<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Komplain & Retur — AKRAB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ asset('css/admin_penjual/style.css') }}">
  <style>
    :root {
      --ak-primary: #006E5C;
      --ak-primary-light: #a8d5c9;
      --ak-white: #FFFFFF;
      --ak-background: #f0fdfa;
      --ak-text: #1D232A;
      --ak-muted: #6b7280;
      --ak-border: #E5E7EB;
      --ak-radius: 12px;
      --ak-space: 16px;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      color: var(--ak-text);
      background: var(--ak-background);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .main-layout {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .content-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 1.5rem;
    }
    
    /* Page Header */
    .page-header {
      background: var(--ak-white);
      border-radius: var(--ak-radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--ak-border);
    }
    
    .page-header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--ak-primary);
    }
    
    /* Tab Navigation */
    .tab-nav {
      display: flex;
      background: var(--ak-white);
      border-radius: var(--ak-radius);
      padding: 0.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--ak-border);
      overflow-x: auto;
    }
    
    .tab-item {
      flex: 1;
      text-align: center;
      padding: 0.75rem 1rem;
      cursor: pointer;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ak-text);
      white-space: nowrap;
    }
    
    .tab-item.active {
      background: var(--ak-primary);
      color: white;
    }
    
    .tab-item .badge {
      background: var(--ak-primary-light);
      color: var(--ak-primary);
      border-radius: 50%;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      margin-left: 0.25rem;
    }
    
    .tab-item.active .badge {
      background: rgba(255, 255, 255, 0.3);
      color: white;
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Complaints & Returns Cards */
    .items-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .item-card {
      background: var(--ak-white);
      border-radius: var(--ak-radius);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--ak-border);
      overflow: hidden;
    }
    
    .item-header {
      padding: 1rem;
      border-bottom: 1px solid var(--ak-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .item-id {
      font-weight: 600;
      color: var(--ak-primary);
    }
    
    .item-date {
      color: var(--ak-muted);
      font-size: 0.875rem;
    }
    
    .customer-name {
      font-weight: 500;
    }
    
    .item-content {
      padding: 1rem;
      border-bottom: 1px solid var(--ak-border);
    }
    
    .item-review {
      margin-bottom: 0.5rem;
    }
    
    .item-reason {
      margin-bottom: 0.5rem;
    }
    
    .item-rating {
      color: #f59e0b;
      font-weight: bold;
    }
    
    .item-footer {
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn {
      border: 1px solid transparent;
      border-radius: var(--ak-radius);
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-outline {
      border: 1px solid var(--ak-primary);
      color: var(--ak-primary);
      background: transparent;
    }
    
    .btn-outline:hover {
      background: var(--ak-primary);
      color: white;
    }
    
    .btn-primary {
      background: var(--ak-primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #005a4a;
    }
    
    .btn-success {
      background: #16a34a;
      color: white;
    }
    
    .btn-success:hover {
      background: #15803d;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .status-pending {
      background: rgba(245, 158, 11, 0.1);
      color: #d97706;
    }
    
    .status-approved {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }
    
    .status-rejected {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
    }
    
    .status-completed {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .tab-nav {
        justify-content: flex-start;
      }
      
      .tab-item {
        min-width: 150px;
      }
    }
  </style>
</head>
<body>
  @include('components.admin_penjual.header')

  <div class="main-layout">
    <div class="content-wrapper">
      <main class="content admin-page-content" role="main">
        <!-- Page Header -->
        <section class="page-header">
          <h1>
            <a href="{{ route('seller.dashboard') }}" class="btn btn-sm" style="margin-right: 1rem; vertical-align: middle; background: var(--ak-primary); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; text-decoration: none;">
              <i class="fas fa-arrow-left"></i>
            </a>
            Komplain & Retur untuk {{ auth()->user()->name }}
          </h1>
        </section>

        <!-- Tab Navigation -->
        <div class="tab-nav">
          <div class="tab-item active" data-tab="complaints">
            Komplain 
            <span class="badge">{{ count($complaints) }}</span>
          </div>
          <div class="tab-item" data-tab="returns">
            Retur 
            <span class="badge">{{ count($returns) }}</span>
          </div>
        </div>

        <!-- Tab Content: Complaints -->
        <div id="complaints-tab" class="tab-content active">
          <section class="items-container" id="complaintsContainer">
            @forelse($complaints as $complaint)
            <div class="item-card">
              <div class="item-header">
                <div>
                  <div class="item-id">#{{ $complaint['id'] }}</div>
                  <div class="item-date">{{ $complaint['created_at'] }}</div>
                </div>
                <div class="customer-name">{{ $complaint['customer_name'] }}</div>
              </div>
              <div class="item-content">
                <div class="item-review">
                  <strong>Ulasan:</strong> {{ $complaint['review_text'] }}
                </div>
                <div class="item-rating">
                  <strong>Rating:</strong> 
                  @for($i = 1; $i <= 5; $i++)
                    @if($i <= $complaint['rating'])
                      <span style="color: #f59e0b;">★</span>
                    @else
                      <span style="color: #d1d5db;">★</span>
                    @endif
                  @endfor
                </div>
                <div class="item-reason">
                  <strong>Produk:</strong> {{ $complaint['product_name'] }}
                </div>
              </div>
              <div class="item-footer">
                <div>
                  <span class="status-badge status-pending">Menunggu Ditanggapi</span>
                </div>
                <div class="action-buttons">
                  <a href="{{ route('seller.reviews.index') }}" class="btn btn-outline">Tanggapi</a>
                </div>
              </div>
            </div>
            @empty
            <div class="text-center p-4">
              <p>Tidak ada komplain ditemukan</p>
            </div>
            @endforelse
          </section>
        </div>

        <!-- Tab Content: Returns -->
        <div id="returns-tab" class="tab-content">
          <section class="items-container" id="returnsContainer">
            @forelse($returns as $return)
            <div class="item-card">
              <div class="item-header">
                <div>
                  <div class="item-id">#{{ $return['id'] }}</div>
                  <div class="item-date">{{ $return['created_at'] }}</div>
                </div>
                <div class="customer-name">{{ $return['customer_name'] }}</div>
              </div>
              <div class="item-content">
                <div class="item-reason">
                  <strong>Alasan Retur:</strong> {{ $return['reason'] }}
                </div>
                <div class="item-review">
                  <strong>Deskripsi:</strong> {{ $return['description'] }}
                </div>
                <div class="item-reason">
                  <strong>Produk:</strong> {{ $return['product_name'] }}
                </div>
                @if($return['refund_amount'])
                <div class="item-review">
                  <strong>Jumlah Refund:</strong> Rp {{ number_format($return['refund_amount'], 0, ',', '.') }}
                </div>
                @endif
                @if($return['tracking_number'])
                <div class="item-review">
                  <strong>No. Resi:</strong> {{ $return['tracking_number'] }}
                </div>
                @endif
              </div>
              <div class="item-footer">
                <div>
                  <span class="status-badge 
                    @if($return['status'] === 'pending') status-pending
                    @elseif($return['status'] === 'approved') status-approved
                    @elseif($return['status'] === 'rejected') status-rejected
                    @elseif($return['status'] === 'completed') status-completed
                    @else status-pending @endif">
                    {{ ucfirst(str_replace('_', ' ', $return['status'])) }}
                  </span>
                </div>
                <div class="action-buttons">
                  @if($return['status'] === 'pending')
                  <button class="btn btn-success" onclick="approveReturn({{ $return['id'] }})">Setujui</button>
                  <button class="btn btn-danger" onclick="rejectReturn({{ $return['id'] }})">Tolak</button>
                  @elseif($return['status'] === 'approved')
                  <button class="btn btn-primary" onclick="completeReturn({{ $return['id'] }})">Selesaikan</button>
                  @else
                  <button class="btn btn-outline" disabled>Telah Diproses</button>
                  @endif
                </div>
              </div>
            </div>
            @empty
            <div class="text-center p-4">
              <p>Tidak ada permintaan retur ditemukan</p>
            </div>
            @endforelse
          </section>
        </div>
      </main>
    </div>
  </div>

  @include('components.admin_penjual.footer')
  
  <script>
    // Tab navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
      const tabItems = document.querySelectorAll('.tab-item');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabItems.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          
          // Remove active class from all tabs and contents
          tabItems.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Add active class to clicked tab and corresponding content
          this.classList.add('active');
          document.getElementById(`${tabName}-tab`).classList.add('active');
        });
      });
    });
    
    // Function to approve return request
    async function approveReturn(returnId) {
      if (confirm('Apakah Anda yakin ingin menyetujui permintaan retur ini?')) {
        try {
          const response = await fetch(`/api/returns/${returnId}/approve`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            alert('Permintaan retur berhasil disetujui');
            location.reload();
          } else {
            alert('Gagal menyetujui permintaan retur: ' + (data.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Terjadi kesalahan saat menyetujui permintaan retur');
        }
      }
    }
    
    // Function to reject return request
    async function rejectReturn(returnId) {
      if (confirm('Apakah Anda yakin ingin menolak permintaan retur ini?')) {
        try {
          const response = await fetch(`/api/returns/${returnId}/reject`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            alert('Permintaan retur berhasil ditolak');
            location.reload();
          } else {
            alert('Gagal menolak permintaan retur: ' + (data.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Terjadi kesalahan saat menolak permintaan retur');
        }
      }
    }
    
    // Function to complete return request
    async function completeReturn(returnId) {
      if (confirm('Apakah Anda yakin ingin menandai permintaan retur ini sebagai selesai?')) {
        try {
          const response = await fetch(`/api/returns/${returnId}/complete`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            alert('Permintaan retur berhasil diselesaikan');
            location.reload();
          } else {
            alert('Gagal menyelesaikan permintaan retur: ' + (data.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Terjadi kesalahan saat menyelesaikan permintaan retur');
        }
      }
    }
  </script>
</body>
</html>